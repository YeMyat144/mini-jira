<div class="container mt-5" >
    <div class="level">
        <div class="level-left">
            <div class="level-item">
                <h1 class="title">Issues</h1>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <div class="buttons">
                    <a class="button is-info" routerLink="/kanban">
                        <span class="icon">
                            <i class="fas fa-columns"></i>
                        </span>
                        <span>Kanban Board</span>
                    </a>
                    <a class="button is-primary" routerLink="/issues/create">
                        <span class="icon">
                            <i class="fas fa-plus"></i>
                        </span>
                        <span>Create New Issue</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="box mb-5">
        <div class="columns">
            <div class="column">
                <div class="field">
                    <label class="label">Project</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select [(ngModel)]="filters.projectId" (change)="applyFilters()">
                                <option [value]="null">All Projects</option>
                                <option *ngFor="let project of projects" [value]="project.id">{{ project.name }}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="field">
                    <label class="label">Assignee</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select [(ngModel)]="filters.assigneeId" (change)="applyFilters()">
                                <option [value]="null">All Assignees</option>
                                <option [value]="-1">Unassigned</option>
                                <option *ngFor="let user of users" [value]="user.id">{{ user.displayName ||
                                    user.username }}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="field">
                    <label class="label">Issue Type</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select [(ngModel)]="filters.issueTypeId" (change)="applyFilters()">
                                <option [value]="null">All Types</option>
                                <option *ngFor="let type of issueTypes" [value]="type.id">{{ type.name }}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="field">
                    <label class="label">Status</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select [(ngModel)]="filters.issueStatusId" (change)="applyFilters()">
                                <option [value]="null">All Statuses</option>
                                <option *ngFor="let status of issueStatuses" [value]="status.id">{{ status.name }}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="field is-grouped is-grouped-right">
            <div class="control">
                <button class="button is-light" (click)="resetFilters()">
                    Reset Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Loading and Error States -->
    <div *ngIf="isLoading" class="has-text-centered my-5">
        <p class="is-size-5">Loading issues...</p>
    </div>

    <div *ngIf="errorMessage" class="notification is-danger">
        {{ errorMessage }}
    </div>

  
    <!-- Issues List -->
    <div class="columns is-multiline" *ngIf="!isLoading && issues.length > 0">
        <div class="column is-one-third" *ngFor="let issue of issues" >
            <div class="card fx-ring" appNeonHover>
                <div class="card-header">
                    <p class="card-header-title">
                        <span *ngIf="issue.issueType" class="icon mr-2" [title]="issue.issueType.name">
                            <i [class]="getIssueTypeIcon(issue.issueType)"></i>
                        </span>
                        {{ issue.title }}
                    </p>
                    <div class="card-header-icon">
                        <span class="tag" [ngClass]="getPriorityClass(issue.priority)">
                            {{ issue.priority }}
                        </span>
                    </div>
                </div>
                <div class="card-content">
                    <div class="content">
                        <p class="issue-key mb-2">{{ issue.project?.key }}-{{ issue.id }}</p>
                        <p>{{ issue.description ? (issue.description | slice:0:150) + (issue.description.length > 150 ?
                            '...' : '') : '' }}</p>
                        <div class="tags">
                            <span class="tag is-success" *ngIf="issue.project">
                                {{ issue.project.name }}
                            </span>
                            <span class="tag" *ngIf="issue.issueStatus"
                                [ngClass]="getStatusClass(issue.issueStatus.name)">
                                {{ issue.issueStatus.name }}
                            </span>
                            <span class="tag is-info" *ngIf="issue.assignee">
                                {{ issue.assignee.displayName || issue.assignee.username }}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <a class="card-footer-item has-text-info" [routerLink]="['/issues', issue.id]">
                        <span class="icon">
                            <i class="fas fa-eye"></i>
                        </span>
                        <span>View</span>
                    </a>
                    <a class="card-footer-item has-text-primary" [routerLink]="['/issues', issue.id, 'edit']">
                        <span class="icon">
                            <i class="fas fa-edit"></i>
                        </span>
                        <span>Edit</span>
                    </a>
                    <a class="card-footer-item has-text-danger" (click)="confirmDelete(issue)">
                        <span class="icon">
                            <i class="fas fa-trash"></i>
                        </span>
                        <span>Delete</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" [class.is-active]="showDeleteModal">
    <div class="modal-background" (click)="cancelDelete()"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Confirm Delete</p>
            <button class="delete" (click)="cancelDelete()"></button>
        </header>
        <section class="modal-card-body">
            <p>Are you sure you want to delete the issue "<strong>{{ issueToDelete?.title }}</strong>"?</p>
            <p class="has-text-grey">This action cannot be undone.</p>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-danger" (click)="delete()" [class.is-loading]="isDeleting">
                Delete
            </button>
            <button class="button" (click)="cancelDelete()">Cancel</button>
        </footer>
    </div>
</div>