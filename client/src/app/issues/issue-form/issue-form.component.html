<div class="container mt-5" appReveal>
    <div class="columns is-centered">
        <div class="column is-8">
            <div class="card fx-ring" appNeonHover>
                <div class="card-header">
                    <p class="card-header-title is-size-4">
                        {{ isEdit ? 'Edit' : 'Create' }} Issue
                    </p>
                </div>
                <div class="card-content">
                    <div *ngIf="isLoading" class="has-text-centered">
                        <p class="is-size-5">Loading...</p>
                    </div>
                    <div *ngIf="errorMessage" class="notification is-danger">
                        {{ errorMessage }}
                    </div>
                    <form *ngIf="!isLoading" [formGroup]="form" (ngSubmit)="submit()">
                        <div class="field">
                            <label class="label">Title</label>
                            <div class="control">
                                <input class="input"
                                    [class.is-danger]="form.get('title')?.invalid && form.get('title')?.touched"
                                    type="text" formControlName="title" placeholder="Enter issue title" />
                            </div>
                            <p class="help is-danger" *ngIf="form.get('title')?.invalid && form.get('title')?.touched">
                                Title is required
                            </p>
                        </div>

                        <div class="field">
                            <label class="label">Description</label>
                            <div class="control">
                                <textarea class="textarea"
                                    [class.is-danger]="form.get('description')?.invalid && form.get('description')?.touched"
                                    formControlName="description" placeholder="Enter issue description"
                                    rows="4"></textarea>
                            </div>
                            <p class="help is-danger"
                                *ngIf="form.get('description')?.invalid && form.get('description')?.touched">
                                Description is required
                            </p>
                        </div>

                        <div class="field">
                            <label class="label">Project</label>
                            <div class="control">
                                <div class="select is-fullwidth"
                                    [class.is-danger]="form.get('projectId')?.invalid && form.get('projectId')?.touched">
                                    <select formControlName="projectId">
                                        <option [value]="null" disabled>Select a project</option>
                                        <option *ngFor="let project of projects" [value]="project.id">{{ project.name }}
                                            ({{ project.key }})</option>
                                    </select>
                                </div>
                            </div>
                            <p class="help is-danger"
                                *ngIf="form.get('projectId')?.invalid && form.get('projectId')?.touched">
                                Project is required
                            </p>
                        </div>

                        <div class="field">
                            <label class="label">Issue Type</label>
                            <div class="control">
                                <div class="select is-fullwidth"
                                    [class.is-danger]="form.get('issueTypeId')?.invalid && form.get('issueTypeId')?.touched">
                                    <select formControlName="issueTypeId">
                                        <option [value]="null" disabled>Select an issue type</option>
                                        <option *ngFor="let type of issueTypes" [value]="type.id">{{ type.name }}
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <p class="help is-danger"
                                *ngIf="form.get('issueTypeId')?.invalid && form.get('issueTypeId')?.touched">
                                Issue type is required
                            </p>
                        </div>

                        <div class="field">
                            <label class="label">Status</label>
                            <div class="control">
                                <div class="select is-fullwidth"
                                    [class.is-danger]="form.get('issueStatusId')?.invalid && form.get('issueStatusId')?.touched">
                                    <select formControlName="issueStatusId">
                                        <option [value]="null" disabled>Select a status</option>
                                        <option *ngFor="let status of issueStatuses" [value]="status.id">{{ status.name
                                            }}</option>
                                    </select>
                                </div>
                            </div>
                            <p class="help is-danger"
                                *ngIf="form.get('issueStatusId')?.invalid && form.get('issueStatusId')?.touched">
                                Status is required
                            </p>
                        </div>

                        <div class="field">
                            <label class="label">Assignee</label>
                            <div class="control">
                                <div class="select is-fullwidth">
                                    <select formControlName="assigneeId">
                                        <option [value]="null">Unassigned</option>
                                        <option *ngFor="let user of users" [value]="user.id">{{ user.displayName ||
                                            user.username }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Priority</label>
                            <div class="control">
                                <div class="select is-fullwidth">
                                    <select formControlName="priority">
                                        <option value="Low">Low</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field is-grouped">
                            <div class="control">
                                <button class="button is-primary" type="submit" [disabled]="form.invalid"
                                    [class.is-loading]="isSubmitting">
                                    {{ isEdit ? 'Update' : 'Create' }} Issue
                                </button>
                            </div>
                            <div class="control">
                                <button class="button is-light" type="button" (click)="router.navigate(['/'])">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>