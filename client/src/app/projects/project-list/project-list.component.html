<div class="container mt-5">
  <div class="level mb-5">
    <div class="level-left">
      <h2 class="title is-2 level-item">Projects</h2>
    </div>
    <div class="level-right">
      <button class="button is-primary" (click)="openCreateForm()">
        <span class="icon">
          <i class="fas fa-plus-circle"></i>
        </span>
        <span>New Project</span>
      </button>
    </div>
  </div>

  <div *ngIf="errorMessage" class="notification is-danger is-light">
    <button class="delete" (click)="errorMessage = ''"></button>
    {{ errorMessage }}
  </div>

  <div *ngIf="showForm" class="box mb-5">
    <h3 class="title is-4 mb-4">{{ isEditing ? 'Edit' : 'Create' }} Project</h3>
    <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
      <div class="field">
        <label class="label">Project Name</label>
        <div class="control">
          <input class="input" type="text" formControlName="name" [ngClass]="{'is-danger': projectForm.get('name')?.invalid && projectForm.get('name')?.touched}">
        </div>
        <p *ngIf="projectForm.get('name')?.invalid && projectForm.get('name')?.touched" class="help is-danger">
          Project name is required
        </p>
      </div>

      <div class="field">
        <label class="label">Project Key</label>
        <div class="control">
          <input class="input" type="text" formControlName="key" placeholder="e.g. PROJ" [ngClass]="{'is-danger': projectForm.get('key')?.invalid && projectForm.get('key')?.touched}">
        </div>
        <p *ngIf="projectForm.get('key')?.invalid && projectForm.get('key')?.touched" class="help is-danger">
          <span *ngIf="projectForm.get('key')?.errors?.['required']">Project key is required</span>
          <span *ngIf="projectForm.get('key')?.errors?.['pattern']">Project key must be 2-10 uppercase letters or numbers</span>
        </p>
        <p class="help">A short, unique identifier for this project (2-10 uppercase letters or numbers)</p>
      </div>

      <div class="field">
        <label class="label">Description</label>
        <div class="control">
          <textarea class="textarea" formControlName="description" rows="3"></textarea>
        </div>
      </div>

      <div class="field is-grouped is-grouped-right">
        <div class="control">
          <button type="button" class="button is-light" (click)="cancelForm()">Cancel</button>
        </div>
        <div class="control">
          <button type="submit" class="button is-primary" [disabled]="projectForm.invalid || isLoading">
            <span *ngIf="isLoading" class="icon">
              <i class="fas fa-spinner fa-pulse"></i>
            </span>
            <span>{{ isEditing ? 'Update' : 'Create' }}</span>
          </button>
        </div>
      </div>
    </form>
  </div>

  <div *ngIf="isLoading && !projects.length" class="has-text-centered my-6">
    <span class="icon is-large">
      <i class="fas fa-spinner fa-pulse fa-3x"></i>
    </span>
    <p class="mt-3">Loading projects...</p>
  </div>

  <div *ngIf="!isLoading && !projects.length" class="notification is-info">
    <button class="delete"></button>
    No projects found. Create your first project to get started.
  </div>

  <div class="columns is-multiline">
    <div *ngFor="let project of projects" class="column is-one-third">
      <div class="card">
        <header class="card-header">
          <p class="card-header-title">
            {{ project.name }}
          </p>
          <span class="card-header-icon">
            <span class="tag is-info">{{ project.key }}</span>
          </span>
        </header>
        <div class="card-content">
          <div class="content">
            {{ project.description || 'No description provided' }}
          </div>
        </div>
        <footer class="card-footer">
          <a [routerLink]="['/projects', project.id]" class="card-footer-item has-text-primary">
            <span class="icon">
              <i class="fas fa-eye"></i>
            </span>
            <span>View</span>
          </a>
          <a class="card-footer-item has-text-info" (click)="openEditForm(project)">
            <span class="icon">
              <i class="fas fa-edit"></i>
            </span>
            <span>Edit</span>
          </a>
          <a class="card-footer-item has-text-danger" (click)="deleteProject(project.id)">
            <span class="icon">
              <i class="fas fa-trash"></i>
            </span>
            <span>Delete</span>
          </a>
        </footer>
      </div>
    </div>
  </div>
</div>